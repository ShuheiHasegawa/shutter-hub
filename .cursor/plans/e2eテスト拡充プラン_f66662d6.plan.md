---
name: E2Eテスト拡充プラン
overview: ShutterHub の品質保証を強化するため、主要ユーザーフロー・エッジケース・エラーハンドリングのE2Eテストを拡充し、リリース品質を確保する。
todos:
  - id: profile-tests
    content: プロフィール編集テストの作成（profile-edit.spec.ts）
    status: pending
  - id: messaging-tests
    content: メッセージングテストの作成（messaging.spec.ts）
    status: pending
    dependencies:
      - profile-tests
  - id: review-tests
    content: レビューテストの作成（review-flow.spec.ts）
    status: pending
    dependencies:
      - messaging-tests
  - id: cancellation-tests
    content: キャンセル・キャンセル待ちテストの作成（cancellation.spec.ts）
    status: pending
    dependencies:
      - review-tests
  - id: lottery-tests
    content: 抽選システムテストの作成（lottery-flow.spec.ts）
    status: pending
    dependencies:
      - cancellation-tests
  - id: edge-case-tests
    content: エッジケーステストの作成（同時操作、境界値、データ整合性）
    status: pending
    dependencies:
      - lottery-tests
  - id: error-handling-tests
    content: エラーハンドリングテストの作成（認証、フォーム、サーバー、決済）
    status: pending
    dependencies:
      - edge-case-tests
  - id: additional-feature-tests
    content: 追加機能テストの作成（通知、SNS、多言語）
    status: pending
    dependencies:
      - error-handling-tests
---

# E2E テスト拡充プラン

## 概要

ShutterHub の品質保証を強化するため、E2E テストを拡充します。主要ユーザーフロー・エッジケース・エラーハンドリングのテストを追加し、リリース品質を確保します。

## 現状分析

### 既存テスト（19 ファイル）

| カテゴリ       | ファイル                                                    | 状態     |

| -------------- | ----------------------------------------------------------- | -------- |

| 認証           | `auth/login.spec.ts`, `permissions.spec.ts`                 | 基本対応 |

| ダッシュボード | `dashboard-navigation.spec.ts`                              | 基本対応 |

| 撮影会         | `photo-session-*.spec.ts`, `booking-systems.spec.ts`        | 基本対応 |

| スタジオ       | `studios/*.spec.ts` (4 ファイル)                            | 充実     |

| 即座撮影       | `instant-*.spec.ts` (3 ファイル)                            | 基本対応 |

| 決済           | `escrow-payment.spec.ts`, `enhanced-escrow-payment.spec.ts` | 基本対応 |

| 優先チケット   | `priority-ticket-management.spec.ts`                        | 基本対応 |

| フォトブック   | `quick-photobook.spec.ts`                                   | 基本対応 |

### 不足しているテスト

1. **プロフィール編集** - `tests/e2e/profile/` が空
2. **メッセージング** - 未実装
3. **レビュー投稿** - 未実装
4. **キャンセル・キャンセル待ち** - 未実装
5. **抽選システム詳細** - 未実装
6. **通知システム** - 未実装
7. **SNS 型機能** - 未実装
8. **エラーハンドリング** - 限定的
9. **エッジケース** - 限定的

## 実装計画

### Phase 1: 主要ユーザーフローテスト追加

#### 1.1 プロフィール編集テスト

**ファイル**: `tests/e2e/profile/profile-edit.spec.ts`

```typescript
// テストケース
- プロフィール基本情報の編集・保存
- プロフィール画像のアップロード・変更
- ユーザータイプ別の表示項目確認（model/photographer/organizer）
- バリデーションエラー表示（必須項目、文字数制限）
- 未認証時のリダイレクト
```

#### 1.2 メッセージングテスト

**ファイル**: `tests/e2e/messages/messaging.spec.ts`

```typescript
// テストケース
- 会話一覧の表示
- 新規メッセージ送信
- メッセージの受信・表示
- 撮影会関連の会話開始
- 既読状態の更新
- 添付ファイル送信（画像）
```

#### 1.3 レビューテスト

**ファイル**: `tests/e2e/reviews/review-flow.spec.ts`

```typescript
// テストケース
- レビュー投稿フロー（撮影会終了後）
- 評価・コメント入力
- レビュー一覧表示
- レビューへのリアクション
- 不適切レビューの報告
```

#### 1.4 キャンセル・キャンセル待ちテスト

**ファイル**: `tests/e2e/bookings/cancellation.spec.ts`

```typescript
// テストケース
- 予約のキャンセル（期限内）
- キャンセルポリシー表示
- キャンセル待ち登録
- キャンセル発生時の自動繰り上げ
- キャンセル待ち通知
```

#### 1.5 抽選システム詳細テスト

**ファイル**: `tests/e2e/lottery/lottery-flow.spec.ts`

```typescript
// テストケース
- 抽選エントリー登録
- 抽選結果発表
- 当選者への通知
- 落選者への通知
- 当選辞退時の繰り上げ
- 管理抽選（主催者による手動選定）
```

### Phase 2: エッジケーステスト追加

#### 2.1 同時操作テスト

**ファイル**: `tests/e2e/edge-cases/concurrent-operations.spec.ts`

```typescript
// テストケース
- 同時予約時の在庫管理（楽観的ロック確認）
- 同一撮影会への複数タブからの予約
- 編集中のデータ競合検出
- 同時ログイン（別デバイス）
```

#### 2.2 境界値テスト

**ファイル**: `tests/e2e/edge-cases/boundary-values.spec.ts`

```typescript
// テストケース
- 定員いっぱいの撮影会への予約試行
- 0円撮影会の予約・決済フロー
- 最大文字数入力（タイトル、説明文）
- 長期間先の日付設定
- 過去日付への予約試行（エラー）
```

#### 2.3 データ不整合テスト

**ファイル**: `tests/e2e/edge-cases/data-integrity.spec.ts`

```typescript
// テストケース
-削除された撮影会へのアクセス試行 -
  非公開撮影会へのURLダイレクトアクセス -
  存在しないユーザープロフィールへのアクセス -
  キャンセル済み予約の再操作試行;
```

#### 2.4 ネットワーク状態テスト

**ファイル**: `tests/e2e/edge-cases/network-conditions.spec.ts`

```typescript
// テストケース
-遅いネットワーク環境でのフォーム送信 -
  オフライン時の動作確認 -
  リクエストタイムアウト時のエラー表示 -
  リトライ機能の確認;
```

### Phase 3: エラーハンドリングテスト追加

#### 3.1 認証エラーテスト

**ファイル**: `tests/e2e/errors/auth-errors.spec.ts`

```typescript
// テストケース
-セッション切れ時のリダイレクト -
  無効なトークンでのアクセス -
  権限不足時のエラー表示 -
  ログイン失敗時のメッセージ -
  アカウントロック時の対応;
```

#### 3.2 フォームバリデーションエラーテスト

**ファイル**: `tests/e2e/errors/form-validation.spec.ts`

```typescript
// テストケース
- 必須フィールド未入力時のエラー
- 不正なメールアドレス形式
- パスワード強度不足
- 画像ファイル形式・サイズエラー
- 日付・時刻の論理エラー（終了時刻 < 開始時刻）
```

#### 3.3 サーバーエラーテスト

**ファイル**: `tests/e2e/errors/server-errors.spec.ts`

```typescript
// テストケース
- 500エラー時のユーザー向けメッセージ
- 404ページの表示
- 503サービス一時停止時の表示
- エラー発生時のフォームデータ保持
```

#### 3.4 決済エラーテスト

**ファイル**: `tests/e2e/errors/payment-errors.spec.ts`

```typescript
// テストケース
-カード決済失敗時のエラー表示 -
  残高不足時の対応 -
  決済タイムアウト時の対応 -
  二重決済防止の確認;
```

### Phase 4: 追加機能テスト

#### 4.1 通知システムテスト

**ファイル**: `tests/e2e/notifications/notification-flow.spec.ts`

```typescript
// テストケース
-リアルタイム通知の受信 -
  通知一覧表示 -
  通知の既読処理 -
  通知設定の変更 -
  トースト通知の表示;
```

#### 4.2 SNS 型機能テスト

**ファイル**: `tests/e2e/social/social-features.spec.ts`

```typescript
// テストケース
- フォロー/アンフォロー
- フォロワー一覧表示
- タイムライン表示
- 投稿作成・削除
- いいね機能
```

#### 4.3 多言語対応テスト

**ファイル**: `tests/e2e/i18n/language-switch.spec.ts`

```typescript
// テストケース
- 言語切り替え（日本語 <-> 英語）
- URLロケール変更時の画面遷移
- フォームラベル・エラーメッセージの翻訳
- 日付・価格フォーマットの変化
```

## テスト構造（追加後）

```
tests/e2e/
├── auth/                      # 認証（既存）
├── bookings/                  # 予約関連（新規）
│   └── cancellation.spec.ts
├── dashboard/                 # ダッシュボード（既存）
├── edge-cases/                # エッジケース（新規）
│   ├── boundary-values.spec.ts
│   ├── concurrent-operations.spec.ts
│   ├── data-integrity.spec.ts
│   └── network-conditions.spec.ts
├── errors/                    # エラーハンドリング（新規）
│   ├── auth-errors.spec.ts
│   ├── form-validation.spec.ts
│   ├── payment-errors.spec.ts
│   └── server-errors.spec.ts
├── i18n/                      # 多言語（新規）
│   └── language-switch.spec.ts
├── instant/                   # 即座撮影（既存）
├── lottery/                   # 抽選（新規）
│   └── lottery-flow.spec.ts
├── messages/                  # メッセージング（新規）
│   └── messaging.spec.ts
├── notifications/             # 通知（新規）
│   └── notification-flow.spec.ts
├── priority-tickets/          # 優先チケット（既存）
├── profile/                   # プロフィール（新規）
│   └── profile-edit.spec.ts
├── reviews/                   # レビュー（新規）
│   └── review-flow.spec.ts
├── social/                    # SNS機能（新規）
│   └── social-features.spec.ts
├── studios/                   # スタジオ（既存）
└── utils/                     # ユーティリティ（既存）
```

## 成果物

1. **追加テストファイル**: 約 15 ファイル
2. **テストカバレッジレポート**: 主要機能のカバレッジ
3. **テスト実行レポート**: CI/CD 統合設定

## 推定時間

| フェーズ | 内容               | 時間 |

| -------- | ------------------ | ---- |

| Phase 1  | 主要ユーザーフロー | 3 日 |

| Phase 2  | エッジケース       | 2 日 |

| Phase 3  | エラーハンドリング | 2 日 |

| Phase 4  | 追加機能           | 2 日 |

**合計**: 9 日

## 優先順位

1. **最優先**: Phase 1（主要ユーザーフロー）+ Phase 3.1-3.2（認証・フォームエラー）
2. **重要**: Phase 2.1-2.2（同時操作・境界値）+ Phase 3.3-3.4（サーバー・決済エラー）
3. **推奨**: Phase 4（追加機能）+ Phase 2.3-2.4（データ整合性・ネットワーク）

## 実行コマンド

```bash
# 全E2Eテスト実行
npm run test:e2e

# カテゴリ別実行
npx playwright test tests/e2e/profile/
npx playwright test tests/e2e/errors/
npx playwright test tests/e2e/edge-cases/

# ヘッドレスモードでデバッグ
npx playwright test --headed --debug

# 特定ブラウザで実行
npx playwright test --project=chromium
```