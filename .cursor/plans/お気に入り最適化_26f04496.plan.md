---
name: お気に入り最適化
overview: 個別リクエスト20回を1回のバルク取得に削減。SWRキャッシュで重複排除と高速化を実現。
todos: []
---

# お気に入り状態チェック最適化

## 目標

個別リクエスト 20 回 → バルク取得 1 回に削減し、SWR キャッシュで高速化

## 実装概要

### 1. useFavoriteStates フック作成

新規ファイル: hooks/useFavoriteStates.ts

SWR でバルク取得をラップ。重複排除と楽観的更新をサポート。

### 2. FavoriteHeartButton 改修

対象: [src/components/ui/favorite-heart-button.tsx](src/components/ui/favorite-heart-button.tsx)

- initialState を必須化
- useEffect での個別取得削除（Line 86-277）
- 未認証時は return null

### 3. PhotoSessionList 改修

対象: [src/components/photo-sessions/PhotoSessionList.tsx](src/components/photo-sessions/PhotoSessionList.tsx)

- useFavoriteStates 使用
- 手動取得削除（Line 215-290）

### 4. StudiosList 改修

対象: [src/components/studio/StudiosList.tsx](src/components/studio/StudiosList.tsx)

同様のパターン適用

### 5. 検証

Network Tab で個別リクエスト 0 回、バルク取得 1 回を確認

## 期待効果

リクエスト数: 95%削減、初回表示: 75%高速化、復帰時間: 95%高速化