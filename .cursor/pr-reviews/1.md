Skip to content
Navigation Menu
ShuheiHasegawa
shutter-hub

Type / to search
Code
Issues
1
Pull requests
1
Zenhub
Actions
Projects
Wiki
Security
3
Insights
Settings
 Open
feat: QR code check-in system (#1)
#2
ShuheiHasegawa wants to merge 5 commits into main from feature/1-qr-code-checkin-system 
+3,000 âˆ’39 
 Conversation 22
 Commits 5
 Checks 3
 Files changed 19
Conversation
@ShuheiHasegawa
Owner
ShuheiHasegawa
commented
28 minutes ago
â€¢ 
Closes #1

Note

Introduces a complete QR-driven check-in/out system across backend, UI, and i18n.

DB/migrations: add checked_in_at, checked_out_at, slot_id (+ indexes/comments) and an organizer update RLS policy in 20251227055024_add_checkin_to_bookings.sql
Types: extend Booking with slot_id, checked_in_at, checked_out_at
Server Actions: checkInToSlot (conditional updates to prevent races), getCheckInStatus, getSessionCheckInStatus
Pages/UI:
New src/app/[locale]/checkin/[slotId]/page.tsx (uses action=scan to execute check-in and show result)
SlotQRCode renders QR for ${BASE_URL}/{locale}/checkin/{slotId}?action=scan, with print/download helpers
CheckInManagement shows per-slot QR + stats and "print all" for organizers; integrated into organizer panel
BookingCheckInStatus displays user check-in state on session detail
CertificateGenerator creates shareable attendance images after check-in
Styling/i18n: add src/styles/print.css, scrollbar utilities in globals.css, and checkin translations in messages/en.json and messages/ja.json
Deps: add qrcode.react, html2canvas, file-saver (+ types)
Integration: update PhotoSessionDetail and OrganizerManagementPanel to embed check-in features and apply print:hidden where appropriate
Written by Cursor Bugbot for commit be4ef92. This will update automatically on new commits. Configure here.

Summary by CodeRabbit
New Features
QR code-based check-in for session slots: scan to record arrival and departure.
Organizer dashboard showing per-slot check-in statistics and printable QR code sheets.
Participant-facing booking status with check-in/checkout timestamps.
Downloadable/shareable digital attendance certificates after check-in.
Print-optimized layouts for QR codes and session details.
UI text added for English and Japanese locales.
âœï¸ Tip: You can customize this high-level summary in your review settings.

ShuheiHasegawa added 4 commits 41 minutes ago
@ShuheiHasegawa
feat: ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã¨Server Actionsã‚’è¿½åŠ  
399f45f
@ShuheiHasegawa
feat: QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆã¨ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ  
194ec4a
@ShuheiHasegawa
feat: ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ç®¡ç†UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’çµ±åˆ 
c4a91df
@ShuheiHasegawa
feat: å…¥å ´è¨¼æ˜æ›¸ç”Ÿæˆã€å°åˆ·ã‚¹ã‚¿ã‚¤ãƒ«ã€å¤šè¨€èªå¯¾å¿œã‚’è¿½åŠ  
040c26d
@ShuheiHasegawa ShuheiHasegawa self-assigned this 28 minutes ago
@vercel
vercel bot
commented
28 minutes ago
â€¢ 
The latest updates on your projects. Learn more about Vercel for GitHub.

Project	Deployment	Review	Updated (UTC)
shutter-hub	Ready Ready	Preview, Comment	Dec 28, 2025 4:31am
@coderabbitai
coderabbitai bot
commented
28 minutes ago
â€¢ 
Note

Other AI code review bot(s) detected
CodeRabbit has detected other AI code review bot(s) in this pull request and will avoid duplicating their findings in the review comments. This may lead to a less comprehensive review.

Warning

.coderabbit.yaml has a parsing error
The CodeRabbit configuration file in this repository has a parsing error and default settings were used instead. Please fix the error(s) in the configuration file. You can initialize chat with CodeRabbit to get help with the configuration file.

ğŸ’¥ Parsing errors (1)
âš™ï¸ Configuration instructions
ğŸ“ Walkthrough
Pre-merge checks and finishing touches
âŒ Failed checks (1 warning)
âœ… Passed checks (4 passed)
âœ¨ Finishing touches
Thanks for using CodeRabbit! It's free for OSS, and your support helps us grow. If you like it, consider giving us a shout-out.

â¤ï¸ Share
Comment @coderabbitai help to get the list of available commands and usage tips.

@vercel vercel bot deployed to Preview 27 minutes ago
cursor[bot]
cursor bot reviewed 24 minutes ago
cursor bot
left a comment
This PR is being reviewed by Cursor Bugbot
Details
src/components/checkin/CertificateGenerator.tsx
src/app/[locale]/checkin/[slotId]/page.tsx
src/components/qr-code/SlotQRCode.tsx
coderabbitai[bot]
coderabbitai bot reviewed 24 minutes ago
coderabbitai bot
left a comment
Actionable comments posted: 10

ğŸ§¹ Nitpick comments (6)
ğŸ“œ Review details
.cursor/plans/qrã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…_75e99267.plan.md

### ææ¡ˆ1: è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½

**èª²é¡Œ**: é€€å ´æ™‚ã«å†åº¦ã‚¹ã‚­ãƒ£ãƒ³ã‚’å¿˜ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹**è§£æ±ºç­–**:
@coderabbitai
coderabbitai bot
24 minutes ago
âš ï¸ Potential issue | ğŸŸ¡ Minor

Formatting issue: missing line break.

There's a missing newline between the two sections, causing them to run together: ãŒã‚ã‚‹**è§£æ±ºç­–**:.

ğŸ” Proposed fix
ğŸ“ Committable suggestion
ğŸ¤– Prompt for AI Agents
@ShuheiHasegawa	Reply...
messages/en.json
messages/ja.json
src/app/actions/checkin.ts
Outdated
src/app/actions/checkin.ts
Comment on lines 150 to 170
/**
 * ã‚¹ãƒ­ãƒƒãƒˆã®ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³çŠ¶æ³ã‚’å–å¾—ï¼ˆé‹å–¶è€…ç”¨ï¼‰
 */
export async function getCheckInStatus(
  slotId: string
): Promise<CheckInStatus | null> {
  try {
    const supabase = await createClient();

    // ã‚¹ãƒ­ãƒƒãƒˆæƒ…å ±ã‚’å–å¾—
    const { data: slot, error: slotError } = await supabase
      .from('photo_session_slots')
      .select('id, slot_number, start_time, end_time, photo_session_id')
      .eq('id', slotId)
      .single();

    if (slotError || !slot) {
      logger.error('Slot not found:', slotError);
      return null;
    }

@coderabbitai
coderabbitai bot
24 minutes ago
âš ï¸ Potential issue | ğŸŸ¡ Minor

ğŸ§© Analysis chain
Add explicit authorization check to verify organizer status.

This function is documented as "é‹å–¶è€…ç”¨" (for organizers), but lacks an explicit authorization check at the application layer. While Supabase RLS policies will prevent unauthorized users from viewing booking details, the function should validate that the caller is the organizer before executing the query. This is consistent with the pattern used throughout the codebase (e.g., requireAuthForAction() in admin-system.ts and photo-session-lottery.ts) and provides defense-in-depth security.

ğŸ¤– Prompt for AI Agents
@ShuheiHasegawa	Reply...
src/components/checkin/CertificateGenerator.tsx
Outdated
src/components/checkin/CertificateGenerator.tsx
Comment on lines +52 to +53
    } catch {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: è¨¼æ˜æ›¸ç”Ÿæˆå¤±æ•—
@coderabbitai
coderabbitai bot
24 minutes ago
âš ï¸ Potential issue | ğŸŸ¡ Minor

Silent error handling provides no user feedback.

The empty catch block silently swallows errors during certificate generation. Users won't know if generation failed.

ğŸ” Proposed fix
ğŸ¤– Prompt for AI Agents
@ShuheiHasegawa	Reply...
src/components/checkin/CertificateGenerator.tsx
src/styles/print.css
supabase/migrations/20251227055024_add_checkin_to_bookings.sql
@ShuheiHasegawa
fix: PRãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜äº‹é …ã®ä¿®æ­£ 
be4ef92
@sonarqubecloud
sonarqubecloud bot
commented
6 minutes ago
Quality Gate Failed Quality Gate failed
Failed conditions
 5.5% Duplication on New Code (required â‰¤ 3%)
 D Reliability Rating on New Code (required â‰¥ A)

See analysis details on SonarQube Cloud

 Catch issues before they fail your Quality Gate with our IDE extension  SonarQube for IDE

@vercel vercel bot deployed to Preview 5 minutes ago
coderabbitai[bot]
coderabbitai bot reviewed 3 minutes ago
coderabbitai bot
left a comment
Actionable comments posted: 1

â™»ï¸ Duplicate comments (7)
ğŸ§¹ Nitpick comments (4)
ğŸ“œ Review details
src/app/[locale]/checkin/[slotId]/page.tsx
Comment on lines +66 to +84
            ? {
                success: true,
                message: booking.checked_out_at
                  ? 'ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ¸ˆã¿'
                  : booking.checked_in_at
                    ? 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿'
                    : 'æœªãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³',
                type: booking.checked_out_at
                  ? 'already_completed'
                  : booking.checked_in_at
                    ? 'checkin'
                    : undefined,
                checked_in_at: booking.checked_in_at,
                checked_out_at: booking.checked_out_at,
              }
            : {
                success: false,
                message: 'äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
              }
@coderabbitai
coderabbitai bot
3 minutes ago
âš ï¸ Potential issue | ğŸŸ¡ Minor

Hard-coded Japanese strings should use translation keys.

The result messages ('ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ¸ˆã¿', 'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ¸ˆã¿', 'æœªãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³', 'äºˆç´„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“') are hard-coded in Japanese. These should use the t() translation function for i18n consistency.

ğŸ” Proposed fix
Committable suggestion skipped: line range outside the PR's diff.

ğŸ¤– Prompt for AI Agents
@ShuheiHasegawa	Reply...
cursor[bot]
cursor bot reviewed 2 minutes ago
src/app/[locale]/checkin/[slotId]/page.tsx
      .select('checked_in_at, checked_out_at')
      .eq('slot_id', slotId)
      .eq('status', 'confirmed')
      .single();
@cursor
cursor bot
2 minutes ago
Check-in status query fails for organizers with multiple bookings
The booking query for check-in status doesn't filter by user_id, unlike the checkInToSlot action which correctly does. Due to the RLS policy "Organizers can view bookings for their sessions", organizers can see all bookings for their slots. When a slot has multiple confirmed bookings (expected for photo sessions), .single() will fail with an error. The page also doesn't explicitly get the authenticated user to pass the user ID to the query. This causes a runtime error for organizers visiting check-in status pages for slots with multiple participants.

Fix in Cursor Fix in Web

@ShuheiHasegawa	Reply...
src/components/checkin/CertificateGenerator.tsx
      // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã¯è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹å ´åˆã«ä½¿ç”¨
    } finally {
      setIsGenerating(false);
    }
@cursor
cursor bot
2 minutes ago
Loading state ends before certificate generation completes
Both handleDownload and handleShare call canvas.toBlob() which is a callback-based API, not Promise-based. The finally block containing setIsGenerating(false) executes immediately after toBlob is called, not after the callback completes. This causes the loading indicator to disappear and the button to become clickable again while the file save or share operation is still in progress. Users can trigger multiple downloads/shares by clicking repeatedly, and the "Generating..." text disappears prematurely.

Additional Locations (1)
Fix in Cursor Fix in Web

@ShuheiHasegawa	Reply...
This branch was successfully deployed
1 active deployment
Merge info
Some checks were not successful
1 failing, 1 neutral, 3 successful checks


failing checks
SonarCloud Code Analysis
SonarCloud Code AnalysisFailing after 57s â€” Quality Gate failed
neutral checks
Cursor Bugbot
Cursor BugbotCompleted in 5m â€” Bugbot Review
successful checks
CodeRabbit
CodeRabbit â€” Review completed
Vercel
Vercel â€” Deployment has completed
Vercel Preview Comments
Vercel Preview Comments â€” âœ… No unresolved feedback
No conflicts with base branch
Merging can be performed automatically.

You can also merge this with the command line. 
Still in progress?
@ShuheiHasegawa


Add a comment
Comment
 
Add your comment here...
 
Remember, contributions to this repository should follow our GitHub Community Guidelines.
 ProTip! Add comments to specific lines under Files changed.
Reviewers
@coderabbitai
coderabbitai[bot]
@cursor
cursor[bot]
Still in progress?
Assignees
@ShuheiHasegawa
ShuheiHasegawa
Labels
None yet
Projects
None yet
Milestone
No milestone
Development
Successfully merging this pull request may close these issues.

 [Feature] QRã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
Loading
1 participant
@ShuheiHasegawa
Footer
Â© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Community
Docs
Contact
Manage cookies
Do not share my personal information
Sign in now to use Zenhub