---
alwaysApply: true
---

# ShutterHub 開発コアルール

このファイルを参照したら、このファイル名を発言すること

**重要**: 詳細な実装例やパターンは `development-guide.mdc` を参照してください。

## SEO/タイトル共通化（seo.ts）

- タイトル生成は `src/lib/seo.ts` の `buildTitle(main: string, suffix?: string)` を使用する。
- 出力形式: `{main} (- {suffix}) | ShutterHub`
- 適用箇所: `layout.tsx` の `metadata` または `generateMetadata()`。
- ルール: 一覧/作成は固定、詳細/編集は「名称 + サフィックス」で統一する。

## ESLintチェック方針

### 基本原則

- **実装完了時**: ESLintの**記述エラー**（構文エラー）のみ修正
- **動作確認**: 手動でブラウザ確認（ホットリロード活用）
- **ビルドテスト**: コミット直前のみ実施
- **コミット直前**: 警告レベルまで全チェック

### 推奨コマンド

```bash
# 実装完了時（高速チェック）
npx eslint src/ --format=compact 2>&1 | grep " error:" | head -20
npx eslint src/ --fix

# コミット直前（全チェック）
npx tsc --noEmit
npx eslint src/ --format=compact --max-warnings=0
npm run build
```

## 多言語化基本ルール

### 必須事項

- すべてのユーザー向けテキストは `useTranslations()` を使用
- ハードコードされた日本語・英語は禁止
- 条件分岐テキストも多言語化必須
- データベースフィールドに基づく表示テキストも多言語化必須

### 検出コマンド

```bash
# 日本語ハードコード全般検出
grep -r "['\"]\s*[あ-ん\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]" src/components/
```

## メッセージファイル開発ルール

### 基本ルール

1. **キーの重複禁止**: 同じキーを複数回定義してはいけない
2. **キーの並び順**: 数字 → 大文字 → 小文字（各グループ内はアルファベット順）
3. **階層構造**: 最大5階層まで
4. **命名規則**: camelCase、動詞は現在形
5. **値の記述**: 「です・ます」調、句読点は「、」「。」

詳細は `development-guide.mdc` を参照。

## 日付ユーティリティルール

### 基本原則

- **ネイティブ JavaScript Date API を使用**
- **外部ライブラリ（date-fns等）は使用禁止**
- **タイムゾーンは Asia/Tokyo 固定**
- **多言語化対応必須**

### 必須使用関数

```typescript
import { formatDateLocalized, formatTimeLocalized } from '@/lib/utils/date';
```

詳細は `development-guide.mdc` を参照。

## 日時・価格表示統一ルール

### 基本原則

- **日時・価格表示は必ず共通コンポーネントを使用する**
- **`toLocaleString()`、`toLocaleDateString()`、`toLocaleTimeString()`の直接使用を禁止**

### 必須使用コンポーネント

```typescript
import { FormattedDateTime, DateTime } from '@/components/ui/formatted-display';
import { FormattedPrice, Price } from '@/components/ui/formatted-display';
```

詳細は `development-guide.mdc` を参照。

## ファイル分類・混乱防止ルール

### todo.mdcファイルの厳格な制限

**記載可能**: 未完了タスクリスト、完了済みタスクリスト、優先度表示、依存関係

**記載禁止**: プログラムコード、データベーススキーマ、コンポーネント実装詳細、API仕様、UI/UXデザイン詳細

詳細は `development-guide.mdc` を参照。

## 自動化ルール

### 機能実装完了時の自動処理

機能実装が完了した際は、**Cursorカスタムコマンド `/commit` を使用**してください。

### 調査段階のコミット不要ルール

- **調査・デバッグ目的のコードはコミット不要**
- **問題解決後は調査コードを削除して本来の実装にクリーンアップ**

詳細は `development-guide.mdc` を参照。

## マイグレーション管理の自動化

### MCP連携必須

- **MCP連携のみ使用**: npxコマンドは使用禁止
- **Supabase MCP連携**: 直接データベース操作・マイグレーション適用
- **確実な適用**: マイグレーションファイル作成後は必ずMCP連携で適用

詳細は `development-guide.mdc` を参照。

## コミットメッセージルール

**重要**: コミットメッセージルールの詳細は `.cursor/commands/commit.md` に移動されました。

Cursorカスタムコマンド `/commit` を使用することで、適切なフォーマットとチェックリストに従ったコミット&プッシュが実行できます。

## UI制御方針ルール

### 基本原則

- **無効化制御を避ける**: ボタンやフォームを無効化せず、押下可能にする
- **説明を提供**: なぜその操作ができないかを明確に説明する
- **アップセル機会**: 制限到達時はプラン変更を促進する

詳細は `development-guide.mdc` を参照。

## 画像フォールバック統一ルール

### 基本原則

- **EmptyImageコンポーネントの使用必須**: 画像がない場合は必ず`EmptyImage`を使用する
- **アイコン + グラデーション背景**: `/images/no-image.png`の使用を避ける

詳細は `development-guide.mdc` を参照。

## カラーシステム統一ルール

### 基本原則

- **固定色（Tailwind標準色）の使用禁止**: `text-green-800`, `bg-red-50` 等の直接指定を避ける
- **統合カラーシステム必須使用**: ブランド色・サーフェース色・統合Buttonのみ使用

詳細は `unified-color-system.mdc` を参照。

## Next.js Image最適化ルール

### 基本原則

- **必須使用**: `<img>`タグの代わりに`<Image />`コンポーネントを使用する
- **パフォーマンス**: 自動的な画像最適化・遅延読み込み・レスポンシブ対応

詳細は `development-guide.mdc` を参照。

## 共通コンポーネント活用ルール

### 実装前の確認必須

新しいUI要素を実装する前に、以下を確認すること:

1. **UIコンポーネントカタログを確認**
   - `docs/ui-components-catalog.md`を参照
   - 類似機能の既存コンポーネントがないか確認

2. **src/components/ui/を検索**
   - キーワード検索で類似コンポーネントを探す
   - 例: 「border」「line」「stat」「display」「image」「loading」など

3. **既存実装を参照**
   - 類似画面・機能で使用されているコンポーネントを確認
   - コードレビュー時に重複実装を指摘

### 左ボーダー付き要素の使い分け

| コンポーネント | 用途 | ボーダー幅 | 色 | 使用例 |
|--------------|------|-----------|-----|--------|
| LeftLineSection | セクション区切り | 0.5px | ブランドカラー | フィルターサイドバー、設定画面のセクション |
| StatItem | 統計情報表示 | 4px | グレー/バリアント | 参加者数、料金、ダッシュボード統計 |
| border-l-4直接指定 | カード装飾 | 4px | 状態に応じた色 | カードの状態表示（予約済み、満席など） |

**原則**: `border-l-4`を直接指定する場合は、`StatItem`コンポーネントの使用を検討すること。

詳細は `docs/ui-components-catalog.md` を参照。

## TODO更新の必須チェックリスト

機能実装完了時の必須作業:

- [ ] ビルドチェック: `npm run build` でエラー確認
- [ ] TODO更新: `.cursor/rules/dev-rules/todo.mdc` を更新
- [ ] コミット: 適切なメッセージでコミット
- [ ] プッシュ: `git push origin main`

詳細は `development-guide.mdc` を参照。
