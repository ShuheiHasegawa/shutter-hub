# 要件定義詳細確認コマンド

## 目的
実装にズレが生じないように要件定義をより細かくするためのコマンド。
開発方法が多義にわたる場合は、その都度ユーザーに確認する（最適な方法を選択するため）。
**実装にはまだ入らず、要件の明確化に専念する。**

## 必須確認項目チェックリスト

### 🎯 **機能仕様の明確化**

#### 基本機能要件
- [ ] この機能の**主要な目的・ゴール**は何か？
- [ ] **想定ユーザー**は誰か？（管理者・一般ユーザー・ゲスト・特定の役割）
- [ ] **使用頻度**はどの程度か？（日常的・週次・月次・稀）
- [ ] **重要度・優先度**はどの程度か？（必須・重要・あれば良い）

#### 機能の範囲・境界
- [ ] **含まれる機能**は具体的に何か？
- [ ] **含まれない機能**（スコープ外）は何か？
- [ ] **将来拡張予定**の機能はあるか？
- [ ] **他システムとの連携**は必要か？

#### 入力・出力・処理
- [ ] **入力データ**の形式・制約は？
- [ ] **出力結果**の期待値は？
- [ ] **データ変換・加工**のルールは？
- [ ] **バリデーション**の詳細ルールは？

### 🎨 **UI/UX設計の確認**

#### レイアウト・デザイン
- [ ] **参考となるページ・コンポーネント**はあるか？
- [ ] **レスポンシブ対応**の要件は？（スマホ・タブレット・PC）
- [ ] **ダークモード対応**は必要か？
- [ ] **アクセシビリティ要件**は？（スクリーンリーダー・キーボード操作）

#### ユーザー操作・フロー
- [ ] **操作の流れ**（ユーザージャーニー）は？
- [ ] **エラー時の動作**は？（エラーメッセージ・リカバリ方法）
- [ ] **確認ダイアログ**は必要か？（削除・重要な操作時）
- [ ] **ローディング状態**の表示は？

#### インタラクション・フィードバック
- [ ] **成功時の通知方法**は？（トースト・ページ遷移・更新）
- [ ] **アニメーション・トランジション**の要件は？
- [ ] **ホバー・フォーカス状態**の表示は？
- [ ] **キーボードショートカット**は必要か？

### 📊 **データ設計の確認**

#### データベース設計
- [ ] **新しいテーブル・カラム**は必要か？
- [ ] **既存テーブルとのリレーション**はどうするか？
- [ ] **外部キー制約**による整合性保証は必要か？
- [ ] **インデックス**は必要か？（パフォーマンス要件）
- [ ] **制約条件**（UNIQUE・NOT NULL・CHECK）は？
- [ ] **文字列パース vs データベース設計**どちらが適切か？

#### データの整合性・一貫性
- [ ] **データのバリデーション**ルールは？
- [ ] **重複データ**の扱いは？
- [ ] **データの削除方針**は？（論理削除・物理削除・カスケード）
- [ ] **履歴・ログ**の保持は必要か？

#### パフォーマンス・スケーラビリティ
- [ ] **想定データ量**は？（レコード数・ファイルサイズ）
- [ ] **同時アクセス数**の想定は？
- [ ] **レスポンス時間**の要件は？
- [ ] **キャッシュ戦略**は必要か？

### 🔒 **セキュリティ・権限の確認**

#### 認証・認可
- [ ] **認証が必要**な機能か？認証なしでもアクセス可能か？
- [ ] **ユーザーの権限レベル**による制限は？（admin/organizer/model/photographer）
- [ ] **データの閲覧・編集・削除権限**はどう設定するか？
- [ ] **API アクセス制限**は必要か？

#### データ保護・プライバシー
- [ ] **個人情報**を扱うか？
- [ ] **プライバシー設定**は必要か？（公開・限定公開・非公開）
- [ ] **データの暗号化**は必要か？
- [ ] **監査ログ**の記録は必要か？

#### 不正利用対策
- [ ] **レート制限**は必要か？
- [ ] **スパム対策**は必要か？
- [ ] **不適切コンテンツ**の対策は？
- [ ] **通報・ブロック機能**は必要か？

### 🌐 **技術実装の確認**

#### 技術選択・アーキテクチャ
- [ ] **フロントエンド技術**の制約は？（Next.js・React・TypeScript）
- [ ] **バックエンド技術**の制約は？（Supabase・Server Actions）
- [ ] **外部API・サービス**との連携は？
- [ ] **リアルタイム機能**は必要か？

#### ファイル・画像処理
- [ ] **ファイルアップロード**は必要か？
- [ ] **画像の最適化・リサイズ**は必要か？
- [ ] **ファイル形式の制限**は？
- [ ] **ストレージ容量**の制限は？

#### 通知・コミュニケーション
- [ ] **メール通知**は必要か？
- [ ] **プッシュ通知**は必要か？
- [ ] **リアルタイム更新**は必要か？
- [ ] **多言語化対応**は必要か？

### 🔄 **運用・保守の確認**

#### データ管理・運用
- [ ] **データのバックアップ**方針は？
- [ ] **データの移行**は必要か？
- [ ] **管理画面**での操作は必要か？
- [ ] **レポート・分析機能**は必要か？

#### エラー処理・復旧
- [ ] **エラー発生時の対応**は？
- [ ] **データ復旧方法**は？
- [ ] **ロールバック機能**は必要か？
- [ ] **緊急時の連絡方法**は？

#### 拡張性・将来対応
- [ ] **将来の機能追加**を考慮した設計にするか？
- [ ] **設定の変更**を容易にするか？
- [ ] **A/Bテスト**への対応は必要か？
- [ ] **段階的リリース**は必要か？

## 確認プロセス

### Step 1: 基本要件の確認
1. 上記チェックリストから**該当する項目を特定**
2. **不明・曖昧な項目**をリストアップ
3. **優先度順**に質問を整理

### Step 2: 詳細仕様の確認
1. **具体的な例・ユースケース**で確認
2. **エッジケース・例外処理**を検討
3. **パフォーマンス・制約条件**を明確化

### Step 3: 実装方針の合意
1. **複数の技術的選択肢**を必ず提示（最低2つ以上）
2. **各選択肢のメリット・デメリット**を詳細に説明
3. **長期保守性・拡張性**の観点で評価
4. **推奨案と理由**を明示
5. **ユーザーの最終確認**を取得

### Step 4: 要件書の作成
1. **確認した内容を文書化**
2. **実装時の参考資料**として整理
3. **変更履歴**を記録

## 質問テンプレート

### 機能仕様確認
```
「〇〇機能」について詳細を確認させてください：

🎯 基本仕様：
- 目的：[具体的な目的]
- ユーザー：[対象ユーザー]
- 使用頻度：[頻度]

🎨 UI/UX：
- 参考ページ：[既存ページ・コンポーネント]
- レスポンシブ：[対応要件]
- エラー処理：[エラー時の動作]

📊 データ：
- 入力データ：[形式・制約]
- 出力結果：[期待値]
- データ保存：[保存方法・場所]

🔒 セキュリティ：
- 認証要件：[必要・不要]
- 権限制御：[アクセス制限]

これらの点について確認をお願いします。
```

### 技術選択確認
```
「〇〇」の実装について、以下の選択肢があります：

選択肢A：[方法A]
- メリット：[利点]
- デメリット：[欠点]
- 実装工数：[見積もり]

選択肢B：[方法B]
- メリット：[利点]
- デメリット：[欠点]
- 実装工数：[見積もり]

推奨案：[推奨する方法とその理由]

どちらの方向で進めるべきかご指示ください。
```

### データ関連機能の実装方法確認
```
「〇〇機能」のデータ取得方法について確認させてください：

📊 データ関連の実装選択肢：

**選択肢A：文字列パース方式**
- 方法：[既存のテキストフィールドから情報を抽出]
- メリット：[既存データ活用・即座実装可能]
- デメリット：[脆弱性・保守性の問題]
- 実装工数：[短期]

**選択肢B：データベース設計方式**  
- 方法：[新しいカラム・テーブル追加で関連付け]
- メリット：[データ整合性・高性能・拡張性]
- デメリット：[マイグレーション作業必要]
- 実装工数：[中期]

**選択肢C：中間テーブル方式**
- 方法：[関連テーブルでの管理]
- メリット：[正規化・複雑な関係対応]
- デメリット：[複雑性・JOIN必要]
- 実装工数：[長期]

🔍 検討観点：
- データの信頼性：[重要度]
- 将来の拡張性：[必要性]
- 保守性：[重要度]
- 国際化対応：[必要性]

推奨案：[推奨方法と詳細理由]

どの方法で実装すべきかご指示ください。
```

## 注意事項

- **実装開始前**に必ずこのコマンドを使用する
- **曖昧な要件**は必ず確認する
- **複数の解釈**が可能な場合は選択肢を提示する
- **技術的制約**がある場合は事前に説明する
- **変更が困難**な部分は特に慎重に確認する