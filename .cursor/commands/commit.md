# Commit and Push

## Overview
ShutterHub v2の開発ルールに従って、機能実装完了時に適切なコミット&プッシュを実行します。

## 🔄 **機能実装完了時の自動処理手順**

### **Step 1: ビルドチェック**
```bash
npm run build
```
エラーがないことを確認してください。

### **Step 2: 開発サーバー停止**
```bash
# 現在のポート使用状況確認
lsof -ti:8888

# 開発サーバープロセス停止（必須）
lsof -ti:8888 | xargs kill -9

# 特定プロセスID停止（個別対応時）
# kill -9 [プロセスID]
```

### **Step 3: 調査コードのクリーンアップ**
以下の調査・デバッグ目的のコードを削除してください：
- [ ] console.log("調査用ログ")
- [ ] console.error("デバッグ詳細", error)
- [ ] alert("テスト確認")
- [ ] JSON.stringify(error, null, 2)（詳細エラー出力）
- [ ] 一時的なデータ構造変更
- [ ] テスト用の条件分岐

### **Step 4: 【必須】TODO更新**
`.cursor/rules/dev-rules/todo.mdc` を必ず更新：
- [ ] 完了した機能を [ ] → [x] に変更
- [ ] 実装時間・技術成果を詳細に記録
- [ ] Phase完了状況を正確に反映
- [ ] 次期タスクの優先度を調整
- [ ] **禁止**: プログラムコード・技術詳細の記載（専門ファイルへ）

### **Step 5: マイグレーション統合**
新しいマイグレーションがある場合：
- [ ] `supabase/migrations/` の最新マイグレーション確認
- [ ] MCP連携でマイグレーション適用完了確認
- [ ] 関連するTypeScript型定義の更新確認

## 🚀 **コミット実行**

### **コミットメッセージ形式**
```
[type]: [変更内容の日本語要約]

[詳細説明]
- [変更点1]
- [変更点2]
- [変更点3]
```

### **Types**
- `feat`: 新機能追加
- `fix`: バグ修正
- `refactor`: リファクタリング
- `style`: スタイル・UI調整
- `docs`: ドキュメント更新
- `test`: テスト追加・修正
- `chore`: その他の変更
- `db`: データベーススキーマ変更
- `migration`: マイグレーション追加・更新

### **実行コマンド**
```bash
# 1. 全ての変更をステージング
git add .

# 2. 日本語でのコミット（必須）
git commit -m "feat: [実装した機能の日本語要約]"

# 3. リモートリポジトリにプッシュ（必須）
git push origin main
```

## 📋 **コミット前必須チェックリスト**

### **プロセス管理**
- [ ] npm run devプロセスが停止されているか
- [ ] ポート8888が解放されているか
- [ ] バックグラウンドプロセスが残っていないか

### **コード品質**
- [ ] ビルドテスト（npm run build）が成功するか
- [ ] TypeScriptエラーがないか
- [ ] ESLintエラーがないか
- [ ] 修正した機能が正常に動作するか
- [ ] エラーメッセージが表示されないか

### **ドキュメント**
- [ ] TODO.mdcが更新されているか
- [ ] 実装時間・技術成果が記録されているか
- [ ] 変更内容が適切に記録されているか

## ✅ **良いコミットメッセージ例**

```bash
git commit -m "feat: カレンダーコンポーネント実装

ダッシュボードページに撮影会カレンダー表示機能を追加
- Shadcn/ui Calendarコンポーネント使用
- レスポンシブデザイン対応
- 多言語化対応実装"

git commit -m "fix: スタジオ作成ページのSelect.Item空文字列エラー修正

Select.Itemのvalue=\"\"をvalue=\"all\"に変更
- studios/page.tsxの都道府県フィルター修正
- studio.tsのフィルター処理でall値対応
- 一時的な定数フォールバック追加"
```

## ❌ **悪いコミットメッセージ例**

```bash
git commit -m "fix"
git commit -m "update files"
git commit -m "WIP"
git commit -m "Fixed various bugs and added features"
```

## 🎯 **コミット・プッシュのタイミング**

### **必須実行タイミング**
- 機能実装完了時
- TODO更新完了時
- バグ修正完了時
- 型エラー修正完了時
- Phase完了時

### **分割コミット判断基準**
以下の場合は複数回に分けてコミット：
- 機能追加とバグ修正が混在
- フロントエンドとバックエンドの大幅変更
- データベーススキーマ変更と型定義更新
- 設定ファイル変更とソースコード変更

### **統合コミット対象**
以下は1つのコミットにまとめる：
- 同一機能の関連ファイル群
- 型定義とその使用箇所
- ドキュメントとその関連実装

## 🚨 **調査段階のコード（コミット不要）**

### **調査完了後の必須作業**
1. **調査用コード削除**
   - 調査用console.logの完全削除
   - テスト用alertの削除
   - 詳細エラー出力の削除

2. **クリーンな実装復元**
   - 本来のシンプルな実装に復元
   - パフォーマンス重視の処理に戻す
   - 一括処理の復活

3. **クリーンアップ後コミット**
   - 調査コードなしの状態で記録
   - "fix: [問題の修正内容]"でコミット

## 📅 **日付・タイムスタンプ管理**

### **マイグレーションファイル作成時**
```bash
# タイムスタンプ取得
date +"%Y%m%d%H%M%S"

# ファイル名形式
[timestamp]_[snake_case_description].sql
# 例: 20250718115321_create_user_storage_bucket.sql
```

### **ドキュメント作成時**
```bash
# 現在日付取得
date +"%Y-%m-%d"

# 履歴形式
- **YYYY-MM-DD**: 変更内容の詳細
```

## 🔧 **自動化スクリプト（推奨）**

package.jsonに以下のスクリプトを追加：
```json
{
  "scripts": {
    "dev:stop": "lsof -ti:8888 | xargs kill -9 || true",
    "dev:clean": "npm run dev:stop && npm run dev",
    "commit:safe": "npm run dev:stop && npm run build && git add . && echo 'Ready for commit - please run: git commit -m \"your message\"'"
  }
}
```

## 🎯 **最終確認**

コミット実行前に以下を必ず確認：
- [ ] 全ての必須手順が完了している
- [ ] TODO.mdcが最新状態に更新されている
- [ ] ビルドエラーがない
- [ ] 開発サーバーが停止している
- [ ] 適切なコミットメッセージが準備されている

**重要**: 機能実装完了後は必ずこのコマンドを実行してください。TODO更新とコミット・プッシュは開発フローの必須要素です。
