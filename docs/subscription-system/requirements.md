# サブスクリプションシステム要件定義

> **ShutterHub ユーザータイプ別サブスクリプション機能の詳細要件**

## 1. システム概要

### 1.1 目的・背景

#### **ビジネス目的**
- **収益化**: 安定した月額課金収入の確立
- **ユーザー定着**: プレミアム機能による付加価値提供
- **市場差別化**: ユーザータイプ特化型サービスの提供

#### **技術的背景**
- 既存のStripe決済基盤を活用
- 現在のuser_type（モデル・カメラマン・運営者）システムとの統合
- フォトブック機能での機能制限実装を他機能へ拡張

### 1.2 対象ユーザー

#### **📸 モデル (Model)**
- **プライマリーニーズ**: ポートフォリオ管理、撮影会優先参加
- **収益化意欲**: 中程度（自己投資として）
- **価格感度**: 高め（学生・アマチュア含む）

#### **📷 カメラマン (Photographer)**  
- **プライマリーニーズ**: 作品管理、クライアント獲得支援
- **収益化意欲**: 高い（ビジネスツールとして）
- **価格感度**: 中程度（ROI重視）

#### **🎬 運営者 (Organizer)**
- **プライマリーニーズ**: 撮影会運営効率化、収益最大化
- **収益化意欲**: 最高（直接的な収益向上）
- **価格感度**: 低め（ビジネス投資として）

### 1.3 ビジネス目標

#### **短期目標（3ヶ月）**
- サブスクリプション登録率: 15%
- 月額課金収入: 50万円
- ユーザー継続率: 80%

#### **中期目標（1年）**
- サブスクリプション登録率: 30%
- 月額課金収入: 300万円
- 各ユーザータイプでの有料化率: モデル10%、カメラマン25%、運営者50%

## 2. 機能要件

### 2.1 共通機能（全ユーザータイプ）

#### **基本サブスクリプション機能**
- プラン選択・変更・キャンセル
- 請求履歴・次回請求日確認
- 支払い方法管理
- プラン比較表示

#### **共通制限機能**
- フォトブック作成数制限
- プレミアムテンプレートアクセス制限
- エクスポート品質制限（標準・高品質・最高品質）
- サポート優先度（一般・優先）

### 2.2 ユーザータイプ別機能

#### **📸 モデル特化機能**

##### **ポートフォリオ管理**
```yaml
機能内容:
  - 掲載写真数制限: Free(10枚) → Basic(50枚) → Premium(無制限)
  - プロフィール強化: プレミアムバッジ表示
  - 写真品質: 高解像度表示オプション
  
実装方法:
  - user_subscriptions.plan_features.portfolioLimit
  - プロフィールページでの制限チェック
  - 画像アップロード時の数量制限
```

##### **予約優先機能**
```yaml
機能内容:
  - 優先予約チケット: Basic(月2枚) → Premium(月5枚)
  - 抽選撮影会での当選率向上
  - 人気撮影会への先行予約権
  
実装方法:
  - priority_tickets テーブル拡張
  - 月次チケット自動付与バッチ処理
  - 予約システムでの優先度判定
```

#### **📷 カメラマン特化機能**

##### **クライアント管理システム**
```yaml
機能内容:
  - 撮影依頼管理: Pro以上で利用可能
  - クライアント情報管理
  - 撮影スケジュール管理
  - 見積もり・請求書作成
  
実装方法:
  - 新規テーブル: client_projects, client_contacts
  - CRMダッシュボード実装
  - PDF生成機能（見積書・請求書）
```

##### **商用利用機能**
```yaml
機能内容:
  - 透かし除去: Pro以上
  - 商用ライセンス表示: Business以上
  - ブランディングカスタマイズ: Business以上
  - 高解像度エクスポート: Pro以上
  
実装方法:
  - 画像処理時の透かし制御
  - ライセンス情報のメタデータ埋め込み
  - カスタムブランディングUI
```

#### **🎬 運営者特化機能**

##### **高度な分析機能**
```yaml
機能内容:
  - 詳細売上レポート: Standard以上
  - 参加者分析: リピート率、地域分析等
  - 収益予測: 過去データに基づく予測
  - 競合分析: 同地域の撮影会動向
  
実装方法:
  - analytics_reports テーブル
  - データ集計バッチ処理
  - グラフ・チャート表示機能
```

##### **マーケティングツール**
```yaml
機能内容:
  - 自動リマインダー: Professional以上
  - ターゲット広告配信: Professional以上
  - SNS連携投稿: Professional以上
  - メールマーケティング: Professional以上
  
実装方法:
  - marketing_campaigns テーブル
  - 外部SNS API連携
  - メール配信システム拡張
```

### 2.3 管理機能

#### **管理者向け機能**
- 全ユーザーのサブスクリプション状況確認
- プラン変更履歴・統計
- 収益分析・レポート
- 不正利用検知・対応

#### **サポート機能**
- プラン変更サポート
- 請求問題対応
- 機能利用サポート（有料ユーザー優先）

## 3. 非機能要件

### 3.1 パフォーマンス要件

#### **応答時間**
- プラン情報取得: 500ms以内
- サブスクリプション作成: 3秒以内
- 機能制限チェック: 100ms以内

#### **同時接続数**
- サブスクリプション管理: 100並行処理
- 決済処理: 50並行処理

### 3.2 セキュリティ要件

#### **決済セキュリティ**
- PCI DSS準拠（Stripe経由）
- 決済情報の非保存
- 不正利用検知

#### **アクセス制御**
- 機能レベルでの権限チェック
- APIレベルでの認証・認可
- 管理機能への厳格なアクセス制限

### 3.3 可用性要件

#### **システム稼働率**
- 99.9%以上の稼働率
- 決済処理の高可用性確保
- 障害時の自動復旧機能

#### **データバックアップ**
- サブスクリプションデータの日次バックアップ
- 決済履歴の長期保存（7年間）

## 4. 制約事項

### 4.1 技術的制約

#### **既存システム制約**
- 現在のuser_typeシステムとの互換性維持
- Supabase RLSポリシーとの整合性
- 既存のStripe実装との統合

#### **外部サービス制約**
- Stripe API制限: 1秒あたり25リクエスト
- Stripe Webhook処理の冪等性確保
- 通貨制限: 当初はJPYのみ

### 4.2 ビジネス的制約

#### **価格設定制約**
- 競合サービスとの価格競争力維持
- 既存無料ユーザーからの反発最小化
- 為替変動リスク（将来的な海外展開時）

#### **法的制約**
- 消費者契約法への準拠
- 特定商取引法への準拠
- 個人情報保護法への準拠

## 5. リスク・課題

### 5.1 技術的リスク

#### **高リスク**
- **Stripe Webhook処理の信頼性**: 重複処理・失敗時の対応
- **既存ユーザーデータ移行**: データ不整合リスク
- **機能制限の複雑性**: パフォーマンス影響

#### **中リスク**
- **ユーザータイプ変更時の処理**: プラン移行の複雑性
- **大量ユーザー時のスケーラビリティ**: データベース負荷
- **決済失敗時の処理**: ユーザー体験への影響

### 5.2 ビジネス的リスク

#### **高リスク**
- **ユーザー離脱**: 有料化による既存ユーザーの流出
- **価格設定ミス**: 市場価格との乖離
- **競合対応**: 類似サービスの価格競争

#### **中リスク**
- **サポート負荷増大**: 有料ユーザーからの問い合わせ増加
- **機能開発遅延**: 約束した機能の未実装
- **法的コンプライアンス**: 法規制変更への対応

### 5.3 対策・軽減策

#### **技術的対策**
- Webhook処理の冪等性確保とリトライ機能
- 段階的移行とロールバック機能
- 負荷テストとパフォーマンス監視

#### **ビジネス的対策**
- 段階的な有料化（ソフトローンチ）
- 既存ユーザーへの優遇措置
- 競合価格の継続的モニタリング

## 6. 成功指標（KPI）

### 6.1 収益指標
- **月額経常収益（MRR）**: 目標300万円/年
- **顧客生涯価値（LTV）**: ユーザータイプ別に設定
- **平均顧客単価（ARPU）**: 月額1,500円

### 6.2 利用指標
- **有料転換率**: 全体15%、運営者50%、カメラマン25%、モデル10%
- **継続率**: 6ヶ月継続率80%以上
- **アップグレード率**: 月次5%以上

### 6.3 満足度指標
- **顧客満足度（CSAT）**: 4.0以上/5.0
- **ネットプロモータースコア（NPS）**: 30以上
- **サポート解決率**: 95%以上

## 7. 今後の拡張計画

### 7.1 短期拡張（6ヶ月以内）
- 年額プランの追加（月額の10ヶ月分価格）
- エンタープライズプランの検討
- 追加決済手段（銀行振込等）

### 7.2 中長期拡張（1年以内）
- 多通貨対応（USD、EUR）
- 企業向けプラン
- API利用プラン

---

**文書バージョン**: 1.0  
**最終更新**: 2025-01-18  
**承認者**: 開発チーム  
**次回レビュー**: 2025-02-18
