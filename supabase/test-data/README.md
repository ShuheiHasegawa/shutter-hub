# バランスの取れたテストデータの実行手順

## 概要

現在日付を基準として、過去・現在・未来の撮影会データをバランス良く作成するSQLスクリプトです。

## ⚠️ 重要：外部キー制約エラーの対処

最初のスクリプト実行時に以下のエラーが発生する場合があります：
```
ERROR: insert or update on table "profiles" violates foreign key constraint "profiles_id_fkey"
```

この場合は、**修正版のスクリプト**を使用してください：
- **`balanced_photo_sessions_fixed.sql`** ← こちらを使用

## 修正版の特徴

- 既存のユーザーアカウントを使用してテストデータを作成
- 新しいユーザーを作成せず、外部キー制約エラーを回避
- ユーザーが存在しない場合は適切なエラーメッセージを表示

## 前提条件

テストデータを作成する前に、以下を確認してください：

1. **ユーザーアカウントが存在すること**
   - アプリケーションから少なくとも1つのユーザーアカウントを作成
   - Google、X、Discord等のOAuth認証でサインアップ

2. **プロフィールが作成されていること**
   - サインアップ後、プロフィール設定を完了

## 実行手順

### 方法1：修正版スクリプトを使用（推奨）

1. Supabaseダッシュボードにアクセス
2. SQL Editorを開く
3. **`balanced_photo_sessions_fixed.sql`** の内容をコピー&ペースト
4. 実行ボタンをクリック

### 方法2：既存データの確認

実行前に既存ユーザーを確認したい場合：
```sql
-- 既存ユーザーの確認
SELECT id, email, display_name, user_type FROM profiles LIMIT 5;
```

## 作成されるデータ

### 1. 過去の撮影会（2つ）
- 春のポートレート撮影会（終了）- 10日前
- ストリート写真ワークショップ（終了）- 8日前

### 2. 現在進行中・直近の撮影会（2つ）
- 夕日ポートレート撮影会 - 明日
- コスプレ撮影会【満席】- 2日後

### 3. 近日開催予定の撮影会（2つ）
- 初心者向けカメラ講座 - 4日後
- モデル体験撮影会 - 6日後

### 4. 来週以降の撮影会（4つ）
- 桜満開！春のポートレート撮影会 - 10日後
- プロ向けライティング講座 - 14日後
- 夜景ポートレート撮影会 - 18日後
- 無料体験撮影会 - 21日後

### 5. 遠い未来の撮影会（2つ）
- 夏フェス風撮影会 - 35日後
- プレミアム撮影会【VIP限定】 - 42日後

### 6. 未公開の撮影会（1つ）
- 秋の紅葉撮影会（準備中） - 28日後（未公開）

## 特徴

- **予約方式のバリエーション**: 先着順、抽選、管理抽選、優先予約
- **参加者数のバリエーション**: 空きあり、満席、少し空きなど
- **料金のバリエーション**: 無料から高額まで
- **時期の分散**: 過去から未来まで適切に分散
- **現実的な内容**: 実際の撮影会として成立する内容

## トラブルシューティング

### エラー：「No existing users found」
```
EXCEPTION: No existing users found. Please create a user account first through the application.
```

**解決方法**：
1. アプリケーションにアクセス
2. OAuth認証（Google、X、Discord等）でサインアップ
3. プロフィール設定を完了
4. 再度スクリプトを実行

### エラー：重複データ
同じスクリプトを複数回実行すると重複データが作成されます。

**解決方法**：
```sql
-- 重複データの削除（必要に応じて）
DELETE FROM photo_sessions WHERE title LIKE '%テスト%' OR title LIKE '%撮影会%';
```

## 注意事項

- **安全性**: 既存データは削除せず、追加のみ実行
- **重複回避**: 同じスクリプトの複数回実行は重複データを作成
- **ユーザー依存**: 既存ユーザーアカウントが必要
- **権限**: 適切なデータベース権限が必要 